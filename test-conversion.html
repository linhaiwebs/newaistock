<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Ads è½¬åŒ–æµ‹è¯•å·¥å…·</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }
    input:focus {
      outline: none;
      border-color: #4285f4;
    }
    button {
      background: #4285f4;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
      font-weight: 600;
    }
    button:hover {
      background: #357ae8;
    }
    button.secondary {
      background: #34a853;
    }
    button.secondary:hover {
      background: #2d8e47;
    }
    .log {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 6px;
      border-left: 4px solid #4285f4;
      max-height: 400px;
      overflow-y: auto;
    }
    .log-entry {
      margin-bottom: 10px;
      padding: 8px;
      background: white;
      border-radius: 4px;
      font-size: 13px;
      font-family: 'Monaco', 'Courier New', monospace;
    }
    .log-entry.success {
      border-left: 3px solid #34a853;
    }
    .log-entry.error {
      border-left: 3px solid #ea4335;
    }
    .log-entry.info {
      border-left: 3px solid #4285f4;
    }
    .help {
      margin-top: 20px;
      padding: 15px;
      background: #e8f5e9;
      border-radius: 6px;
      font-size: 14px;
    }
    .help strong {
      color: #2e7d32;
    }
    code {
      background: #f1f3f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ Google Ads è½¬åŒ–æµ‹è¯•å·¥å…·</h1>
    <p class="subtitle">æµ‹è¯• Google Ads è½¬åŒ–è·Ÿè¸ªæ˜¯å¦æ­£ç¡®é…ç½®</p>

    <div class="form-group">
      <label for="ga4Id">Google Analytics 4 Measurement ID</label>
      <input
        type="text"
        id="ga4Id"
        placeholder="G-XXXXXXXXXX"
        value="G-XXXXXXXXXX"
      >
    </div>

    <div class="form-group">
      <label for="adsId">Google Ads è½¬åŒ– ID</label>
      <input
        type="text"
        id="adsId"
        placeholder="AW-123456789"
        value="AW-123456789"
      >
    </div>

    <div class="form-group">
      <label for="conversionId">è½¬åŒ–æ“ä½œ IDï¼ˆå®Œæ•´æ ‡ç­¾ï¼‰</label>
      <input
        type="text"
        id="conversionId"
        placeholder="AW-123456789/AbCdEfGhIj"
        value="AW-123456789/AbCdEfGhIj"
      >
    </div>

    <button onclick="initializeTracking()">1. åˆå§‹åŒ–è·Ÿè¸ª</button>
    <button class="secondary" onclick="testConversion()">2. æµ‹è¯•è½¬åŒ–äº‹ä»¶</button>

    <div class="help">
      <strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong><br>
      1. å¡«å†™ä» Google Ads è·å–çš„ ID<br>
      2. ç‚¹å‡»"åˆå§‹åŒ–è·Ÿè¸ª"åŠ è½½ gtag.js<br>
      3. ç‚¹å‡»"æµ‹è¯•è½¬åŒ–äº‹ä»¶"è§¦å‘è½¬åŒ–<br>
      4. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰â†’ Network æ ‡ç­¾ï¼ŒæŸ¥çœ‹å‘é€åˆ° Google çš„è¯·æ±‚<br>
      5. ç­‰å¾… 5-10 åˆ†é’Ÿï¼Œåœ¨ Google Ads ä¸­æŸ¥çœ‹è½¬åŒ–æ˜¯å¦è®°å½•
    </div>

    <div class="log" id="log">
      <div class="log-entry info">
        <strong>ğŸ“‹ æ—¥å¿—è¾“å‡º</strong><br>
        ç­‰å¾…æ“ä½œ...
      </div>
    </div>
  </div>

  <script>
    let isInitialized = false;
    let conversionActionId = null;

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.innerHTML = `<strong>[${time}]</strong> ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    function initializeTracking() {
      const ga4Id = document.getElementById('ga4Id').value.trim();
      const adsId = document.getElementById('adsId').value.trim();
      conversionActionId = document.getElementById('conversionId').value.trim();

      if (!ga4Id || !adsId || !conversionActionId) {
        log('âŒ è¯·å¡«å†™æ‰€æœ‰å¿…éœ€çš„ ID', 'error');
        return;
      }

      if (!ga4Id.startsWith('G-')) {
        log('âŒ GA4 Measurement ID æ ¼å¼é”™è¯¯ï¼Œåº”è¯¥ä»¥ G- å¼€å¤´', 'error');
        return;
      }

      if (!adsId.startsWith('AW-')) {
        log('âŒ Google Ads è½¬åŒ– ID æ ¼å¼é”™è¯¯ï¼Œåº”è¯¥ä»¥ AW- å¼€å¤´', 'error');
        return;
      }

      if (!conversionActionId.includes('/')) {
        log('âŒ è½¬åŒ–æ“ä½œ ID æ ¼å¼é”™è¯¯ï¼Œåº”è¯¥åŒ…å« / åˆ†éš”ç¬¦ï¼ˆä¾‹å¦‚ï¼šAW-123/abcï¼‰', 'error');
        return;
      }

      log('ğŸ”„ å¼€å§‹åŠ è½½ Google Analytics...', 'info');

      const script1 = document.createElement('script');
      script1.async = true;
      script1.src = `https://www.googletagmanager.com/gtag/js?id=${ga4Id}`;
      script1.onload = () => {
        log('âœ… gtag.js è„šæœ¬åŠ è½½æˆåŠŸ', 'success');
      };
      script1.onerror = () => {
        log('âŒ gtag.js è„šæœ¬åŠ è½½å¤±è´¥', 'error');
      };
      document.head.appendChild(script1);

      const script2 = document.createElement('script');
      script2.innerHTML = `
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '${ga4Id}');
        gtag('config', '${adsId}');
        console.log('âœ… Google Analytics å’Œ Google Ads åˆå§‹åŒ–å®Œæˆ');
      `;
      document.head.appendChild(script2);

      isInitialized = true;

      log(`âœ… åˆå§‹åŒ–å®Œæˆ`, 'success');
      log(`ğŸ“Š GA4 ID: ${ga4Id}`, 'info');
      log(`ğŸ“¢ Ads ID: ${adsId}`, 'info');
      log(`ğŸ¯ Conversion ID: ${conversionActionId}`, 'info');
      log('ğŸ’¡ æç¤ºï¼šæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰â†’ Network æ ‡ç­¾ï¼Œç­›é€‰ "collect" æŸ¥çœ‹è¯·æ±‚', 'info');
    }

    function testConversion() {
      if (!isInitialized) {
        log('âŒ è¯·å…ˆç‚¹å‡»"åˆå§‹åŒ–è·Ÿè¸ª"', 'error');
        return;
      }

      if (typeof gtag === 'undefined') {
        log('âŒ gtag æœªå®šä¹‰ï¼Œè¯·é‡æ–°åˆå§‹åŒ–', 'error');
        return;
      }

      log('ğŸš€ è§¦å‘ GA4 è‡ªå®šä¹‰äº‹ä»¶: Add', 'info');
      try {
        gtag('event', 'Add');
        log('âœ… GA4 äº‹ä»¶ "Add" å·²è§¦å‘', 'success');
      } catch (error) {
        log(`âŒ GA4 äº‹ä»¶è§¦å‘å¤±è´¥: ${error.message}`, 'error');
      }

      if (conversionActionId) {
        log(`ğŸ¯ è§¦å‘ Google Ads è½¬åŒ–äº‹ä»¶: ${conversionActionId}`, 'info');
        try {
          gtag('event', 'conversion', {
            'send_to': conversionActionId,
            'value': 1.0,
            'currency': 'JPY'
          });
          log('âœ… Google Ads è½¬åŒ–äº‹ä»¶å·²è§¦å‘', 'success');
          log('ğŸ“Š è½¬åŒ–ä»·å€¼: 1.0 JPY', 'info');
        } catch (error) {
          log(`âŒ Google Ads è½¬åŒ–äº‹ä»¶è§¦å‘å¤±è´¥: ${error.message}`, 'error');
        }
      } else {
        log('âš ï¸ æœªè®¾ç½®è½¬åŒ–æ“ä½œ IDï¼Œè·³è¿‡ Google Ads è½¬åŒ–', 'error');
      }

      log('ğŸ“ˆ æŸ¥çœ‹å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾ï¼Œåº”è¯¥çœ‹åˆ°å‘é€åˆ° google-analytics.com çš„è¯·æ±‚', 'info');
      log('â±ï¸ ç­‰å¾… 5-10 åˆ†é’Ÿååœ¨ Google Ads ä¸­æŸ¥çœ‹è½¬åŒ–æ•°æ®', 'info');
    }

    window.addEventListener('load', () => {
      log('âœ… æµ‹è¯•å·¥å…·å·²åŠ è½½', 'success');
      log('ğŸ“ å¡«å†™ Google Ads é…ç½®ä¿¡æ¯åç‚¹å‡»"åˆå§‹åŒ–è·Ÿè¸ª"', 'info');
    });

    window.onerror = function(msg, url, line) {
      log(`âŒ é”™è¯¯: ${msg} (è¡Œ ${line})`, 'error');
      return false;
    };
  </script>
</body>
</html>
